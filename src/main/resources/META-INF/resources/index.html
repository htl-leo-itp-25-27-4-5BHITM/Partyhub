<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Quarkus Static Site</title>
    <link href="global.css" rel="stylesheet">
<!--    <script src="script.js" defer></script>-->
    <script src="backend-functions.js" defer></script>
    <style>
        body {
           color: white;
        }
        .profile-img { width:48px; height:48px; object-fit:cover; border-radius:50%; }
    </style>
    
</head>

<body class="bg-light">


<div class="container py-4">

    <h2 class="mb-3 text-black">Filter Parties</h2>

    <div class="card mb-4">
        <div class="card-body">
            <form id="filterForm" class="row g-3">

                <div class="col-md-4">
                    <label for="filter" class="form-label">Filter type</label>
                    <select id="filter" name="filter" class="form-select">
                        <option value="Category">Category</option>
                        <option value="Content">Content</option>
                        <option value="Date">Date</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label for="param" class="form-label">Search term</label>
                    <input type="text" id="param" name="param" class="form-control" placeholder="e.g. music" required>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-secondary w-100">Search</button>
                </div>

            </form>
        </div>
    </div>

    <h3 class="mb-3 text-black">Result</h3>
    <pre id="output" class="p-3 bg-dark text-light rounded"></pre>

    <a href="./homepage/homepage.html" class="btn btn-link px-0 mt-3">Homepage</a>


    <h2 class="mt-5 text-black">Users</h2>
    <div class="table-responsive">
        <table id="userTable" class="table table-striped table-hover">
            <thead class="table-primary">
            <tr>
                <th>Avatar</th>
                <th>User ID</th>
                <th>Name</th>
                <th>Email</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>


    <h2 class="mt-5 text-black">Parties</h2>
    <div class="table-responsive">
        <table id="partyTable" class="table table-striped table-hover">
            <thead class="table-primary">
            <tr>
                <th>Party ID</th>
                <th>Party Title</th>
                <th>Category ID</th>
                <th>Date start</th>
                <th>Date end</th>
                <th>Max people</th>
                <th>Min age</th>
                <th>Max age</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>


    <h1 class="mt-5 text-black">File Upload</h1>
    <div class="card mb-4">
        <div class="card-body">
            <form action="/api/media/upload/1" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <input type="file" name="file" class="form-control">
                </div>

                <button onclick="addFile(); return false;" class="btn btn-outline-primary me-2">Add file</button>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>

    <h1 class="mt-5 text-black">Geolocation:</h1>
    <div id="demo" class="p-3 bg-white border rounded"></div>
</div>

<script>
    async function loadUsers() {
        try {
            const res = await fetch('/api/users/');
            if (!res.ok) return;
            const users = await res.json();
            const tbody = document.querySelector('#userTable tbody');
            tbody.innerHTML = '';
            users.forEach(u => {
                const tr = document.createElement('tr');
                const imgTd = document.createElement('td');
                const img = document.createElement('img');
                // Use dynamic per-user profile picture endpoint with optional 'name' parameter
                const nameParam = u.profileImage ? '?name=' + encodeURIComponent(u.profileImage) : '';
                img.src = '/api/users/' + u.id + '/profile-picture' + nameParam;
                // fallback to requested profile_picture3.jpg then profilbild1.jpg
                img.onerror = function() {
                    if (!this._triedFallback) {
                        this._triedFallback = 1;
                        this.src = '/images/profile_picture3.jpg';
                    } else if (this._triedFallback === 1) {
                        this._triedFallback = 2;
                        this.src = '/images/profilbild1.jpg';
                    }
                };
                img.className = 'profile-img';
                imgTd.appendChild(img);
                tr.appendChild(imgTd);

                const idTd = document.createElement('td'); idTd.textContent = u.id; tr.appendChild(idTd);
                const nameTd = document.createElement('td'); nameTd.textContent = u.name; tr.appendChild(nameTd);
                const emailTd = document.createElement('td'); emailTd.textContent = u.email; tr.appendChild(emailTd);
                tbody.appendChild(tr);
            });
        } catch (e) {
            console.error(e);
        }
    }
    window.addEventListener('load', loadUsers);
</script>

</body>
</html>
